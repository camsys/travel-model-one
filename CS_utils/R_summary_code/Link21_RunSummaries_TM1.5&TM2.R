#############################################################
##### PARAMETERS AND DIRECTORIES ############################
#############################################################

rm(list=ls())

delimiter = '//'

# This is the directory where the reports are stored:
main_dir = 'C://MTC_tmpy//TM2//Link21_Reports'

# Set preprocessing parameters
preprocess_l = F
preprocess_r = T

# If you are doing model validation against survey data, please
# set skip_l = TRUE, otherwise, set it to FALSE.
# When skip_l == TRUE, fill out section RIGHT; otherwise fill both.
skip_l = F

# set the following switch to TRUE to include GQ households in summaries
# Should be set to FALSE for validation (GQs are not included in hh surveys)
# include_gq = FALSE

# set the following switch to TRUE to produce summary sheet for each MPO
# When [MPO Name] = TRUE, produce summary sheet. "ALL" includes the entire dataset.
MTC = TRUE

# set the following switch to TRUE to produce county summary sheet for each county
# When [County Name] = TRUE, produce summary sheet. "ALL" includes the entire dataset.
# `San Francisco`
# `San Mateo`	
# `Santa Clara`	
# Alameda	
# `Contra Costa`
# Solano	
# Napa
# Sonoma
# Marin
ALL = TRUE

# Name of the scenario will appear in summary spreadsheets as suffix.
scenario = 'TM1.5vsLink21_09-07-2022'

############################################################

setwd(paste(main_dir, '..', sep = delimiter))
source('_code//Link21_utilities.R')
source('_code//Link21_vehicle_avail.R')
source('_code//Link21_CDAP.R')
source('_code//Link21_tour_freq.R')
source('_code//Link21_tour_dest_choice.R')
source('_code//Link21_tour_mode_choice.R')
source('_code//Link21_tour_tod_choice.R')
source('_code//Link21_stop_freq.R')
source('_code//Link21_stop_dest_choice.R')
source('_code//Link21_trip_mode_choice.R')
source('_code//Link21_trip_tod_choice.R')
source('_code//Link21_dest_choice_bigdata.R')

#############################################################

#############################################################
################## ##########################################
##################   ########################################
######     RIGHT       ######### Fill always ################
##################   ########################################
################## ##########################################
#############################################################

##############################################################################################################################
# The MTC models produces individual and joint tour/trips, which is inconsistent with the survey and the original code design.  
# To address this, a new separate script were written to process a combined trip and tour file.
# Note that for each scenario this only needs to be done once!


#### Only (manually) run once! ####
if (preprocess_l) {
  model_data_dir='C://MTC_tmpy//TM2//2015_BaseY_PYT2015//'
  setwd(paste(main_dir, '..', sep = delimiter))
  source('_code//TM2_Model_Files_PreProcessing.R')
}

if (preprocess_r) {
  model_data_dir='C://MTC_tmpy//TM2//2015_BaseY_P3Y2015//'
  setwd(paste(main_dir, '..', sep = delimiter))
  source('_code//TM2_Model_Files_PreProcessing.R')
}
##############################################################################################################################

# These correspond to the inputs of tables on the right. These fields should always be filled.
name_model_r = 'Link21_09-07-2022'
survey_r =FALSE
# The Java version of the model have a sampling factor that is currently set to 0.01.
# That means all observations have a weight of 100.
# This is used in the utilities script and need to be set to match the model run.
model_version_r = 'TM2'
model_run_weight_r = 100

input_dir_r = 'C://MTC_tmpy//TM2//2015_BaseY_P3Y2015//_pre_processed//'
in_person_r = 'in_person.csv'
in_hh_r = 'in_hh.csv'
in_MPO_r = 'in_taz.csv'

output_dir_r = 'C://MTC_tmpy//TM2//2015_BaseY_P3Y2015//_pre_processed//'
out_person_r = 'out_person_data.csv'
out_hh_r     = "out_hh_data.csv"
out_tours_r  = 'out_tour_data.csv'
out_stops_r  = 'out_trip_data.csv'

skim_dir_r = 'C://MTC_tmpy//TM2//2015_BaseY_P3Y2015//_pre_processed//'
skim_am_time_r = 'TimeSkimsDatabaseAM.csv'
skim_am_dist_r = 'DistanceSkimsDatabaseAM.csv'
skim_op_time_r = 'TimeSkimsDatabaseEA.csv'
skim_op_dist_r = 'DistanceSkimsDatabaseEA.csv'
#############################################################
########## ##################################################
########   ##################################################
######       LEFT      ######### Fill when skip_l = FALSE ###
########   ##################################################
########## ##################################################
#############################################################
name_model_l = '2015_TM1.5'
survey_l = FALSE
model_version_l = 'TM1.5'
model_run_weight_l = 2

input_dir_l = 'C://MTC_tmpy//TM2//Link21_Reports//TM1.5_results//_pre_processed//'
in_person_l = 'in_person.csv'
in_hh_l = 'in_hh.csv'
in_MPO_l = 'in_taz.csv'

output_dir_l = 'C://MTC_tmpy//TM2//Link21_Reports//TM1.5_results//_pre_processed//'
out_person_l = 'out_person_data.csv'
out_hh_l     = "out_hh_data.csv"
out_tours_l  = 'out_tour_data.csv'
out_stops_l  = 'out_trip_data.csv'

skim_dir_l = 'C://MTC_tmpy//TM2//Link21_Reports//TM1.5_results//_pre_processed//'
skim_am_time_l = 'TimeSkimsDatabaseAM.csv'
skim_am_dist_l = 'DistanceSkimsDatabaseAM.csv'
skim_op_time_l = 'TimeSkimsDatabaseEA.csv'
skim_op_dist_l = 'DistanceSkimsDatabaseEA.csv'


#############################################################
######################## READ ###############################
#############################################################

read_files()

#############################################################
######################## RUN ################################
#############################################################

# Run Vehicle_Avail:
Vehicle_Avail('1 - Vehicle_Avail')

# Run CDAP:
CDAP('2 - CDAP')

# Run Tour_Frequency:
Tour_Freq_Choice('3 - Tour_Frequency')

# Run Tour_Dest_Choice:
Tour_Dest_Choice('4 - Tour_Dest_Choice')

# Run Tour_Mode_Choice:
Tour_Mode_Choice('5 - Tour_Mode_Choice')

# Run Tour_TOD_Choice:
Tour_TOD_Choice('6 - Tour_TOD_Choice')

# Run Stop_Frequency:
Stop_Freq_Choice('7 - Stop_Frequency')

# Run Stop_Location_Choice
Stop_Dest_Choice('8 - Stop_Dest_Choice')

# Run Trip_Mode_Choice
Trip_Mode_Choice('9 - Trip_Mode_Choice')

# Run Trip_TOD_Choice
Trip_TOD_Choice('10 - Trip_TOD_Choice')

# Run Dest_Choice_BigData
Dest_Choice_BigData('99 - Dest_Choice_BigData')
